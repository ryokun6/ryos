# Window Manager

ryOS implements a sophisticated multi-instance window manager.

## Window Creation Flow

```
User Action → launchApp() → createAppInstance() → AppManager renders
```

## Instance State

```typescript
interface AppInstance {
  instanceId: string;        // Unique numeric ID
  appId: AppId;              // App identifier
  isOpen: boolean;
  isForeground: boolean;
  isMinimized?: boolean;     // Dock/taskbar minimize state
  isLoading?: boolean;       // For lazy-loaded apps
  position?: { x: number; y: number };
  size?: { width: number; height: number };
  title?: string;            // Static title set at creation
  displayTitle?: string;     // Dynamic title (updated by WindowFrame)
  createdAt: number;         // For stable ordering in taskbar
  initialData?: unknown;     // App-specific data passed at launch
}
```

### Window State Transitions

```mermaid
stateDiagram-v2
    [*] --> Loading: launchApp()
    Loading --> Normal: App loaded
    Normal --> Minimized: minimize()
    Minimized --> Normal: restore()
    Normal --> Maximized: maximize()
    Maximized --> Normal: restore()
    Normal --> Foreground: bringToFront()
    Foreground --> Background: Another window focused
    Background --> Foreground: bringToFront()
    Normal --> [*]: closeApp()
    Minimized --> [*]: closeApp()
    Maximized --> [*]: closeApp()
```

## Z-Index Management

Z-index is calculated from position in `instanceOrder` array. The end of the array is the foreground (top) window.

```mermaid
graph TB
    subgraph instanceOrder["instanceOrder Array"]
        direction TB
        A["[0] finder-1"] --> B["[1] textedit-2"]
        B --> C["[2] ipod-3"]
        C --> D["[3] chats-4 ← foreground"]
    end
    
    subgraph zIndex["Z-Index Stack (visual)"]
        direction TB
        Z4["z:103 chats-4 (top)"]
        Z3["z:102 ipod-3"]
        Z2["z:101 textedit-2"]
        Z1["z:100 finder-1 (bottom)"]
    end
    
    instanceOrder -.->|"z = BASE + index"| zIndex
```

## Window Constraints

| Property | Type | Description |
|----------|------|-------------|
| `minSize` | `{ width, height }` | Minimum window dimensions |
| `maxSize` | `{ width, height }` | Maximum window dimensions |
| `defaultSize` | `{ width, height }` | Initial window size |
| `mobileDefaultSize` | `{ width, height }` | Size on mobile devices |
| `mobileSquare` | `boolean` | If true, height = width on mobile |

## Multi-Instance Apps

- `textedit` - Multiple documents
- `finder` - Multiple browser windows
- `applet-viewer` - Multiple applets
