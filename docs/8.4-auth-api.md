# Auth API

Authentication endpoints for ryOS. These endpoints handle user registration, login, token management, and password operations.

## Overview

The chat rooms authentication system uses token-based authentication with 90-day expiration. Users authenticate using:

```
Authorization: Bearer {token}
X-Username: {username}
```

Tokens are issued by `/api/auth/register` and `/api/auth/login`.

## Endpoint Summary

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/auth/register` | Create user + issue token |
| POST | `/api/auth/login` | Login with password |
| POST | `/api/auth/logout` | Logout current session |
| POST | `/api/auth/logout-all` | Logout all sessions |
| POST | `/api/auth/token/verify` | Verify token |
| POST | `/api/auth/token/refresh` | Refresh token |
| GET | `/api/auth/password/check` | Check if password set |
| POST | `/api/auth/password/set` | Set password |
| GET | `/api/auth/tokens` | List active tokens |

## Endpoints

### Register User

Create a new user account and receive an authentication token.

```bash
POST /api/auth/register
Content-Type: application/json

{
  "username": "alice",
  "password": "testpassword123"  // optional
}
```

**Response (200):**

```json
{
  "user": { "username": "alice" },
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### Login

Authenticate with username and password.

```bash
POST /api/auth/login
Content-Type: application/json

{
  "username": "alice",
  "password": "testpassword123"
}
```

**Response (200):**

```json
{
  "user": { "username": "alice" },
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### Logout

Invalidate the current session token.

```bash
POST /api/auth/logout
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "success": true
}
```

### Logout All Sessions

Invalidate all active tokens for the user.

```bash
POST /api/auth/logout-all
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "success": true
}
```

### Verify Token

Check if a token is valid.

```bash
POST /api/auth/token/verify
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "valid": true,
  "username": "alice"
}
```

### Refresh Token

Get a new token before the current one expires.

```bash
POST /api/auth/token/refresh
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "token": "eyJhbGciOiJIUzI1NiIs..."
}
```

### Check Password Status

Check if a user has set a password.

```bash
GET /api/auth/password/check
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "hasPassword": true
}
```

### Set Password

Set or update the user's password.

```bash
POST /api/auth/password/set
Authorization: Bearer {token}
X-Username: alice
Content-Type: application/json

{
  "password": "newSecurePassword123"
}
```

**Response (200):**

```json
{
  "success": true
}
```

### List Active Tokens

Get all active session tokens for the user.

```bash
GET /api/auth/tokens
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "tokens": [
    {
      "id": "token1",
      "createdAt": 1704067200000,
      "lastUsed": 1704153600000
    }
  ]
}
```

## Error Responses

| Status | Error | Description |
|--------|-------|-------------|
| 400 | `Invalid request` | Missing or invalid parameters |
| 401 | `Invalid credentials` | Wrong username or password |
| 401 | `Invalid token` | Token is invalid or expired |
| 403 | `Unauthorized` | Origin not allowed |
| 404 | `User not found` | Username doesn't exist |
| 409 | `User already exists` | Username taken (on register) |
| 429 | `Rate limit exceeded` | Too many requests |

## Related

- [Rooms API](/docs/rooms-api) - Room endpoints
- [Messages API](/docs/messages-api) - Message endpoints
- [API Design Guide](/docs/api-design-guide) - API patterns and conventions
