# Rooms API

Endpoints for creating, listing, and managing chat rooms.

## Overview

Chat rooms are either **public** (visible to all users) or **private** (visible only to members). Users can create, join, leave, and delete rooms.

## Endpoint Summary

| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| GET | `/api/rooms` | List rooms (public + private membership) | No |
| POST | `/api/rooms` | Create room | Yes |
| GET | `/api/rooms/{id}` | Get room by ID | No |
| DELETE | `/api/rooms/{id}` | Delete room | Yes |
| POST | `/api/rooms/{id}/join` | Join room | No |
| POST | `/api/rooms/{id}/leave` | Leave room | No |
| GET | `/api/rooms/{id}/users` | List active users | No |

## Endpoints

### List Rooms

Get all public rooms and private rooms where the user is a member.

```bash
GET /api/rooms?username=alice
```

**Query Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `username` | string | No | Filter to include user's private rooms |

**Response (200):**

```json
{
  "rooms": [
    {
      "id": "general",
      "name": "General Chat",
      "type": "public",
      "createdAt": 1704067200000,
      "createdBy": "ryo",
      "memberCount": 15
    },
    {
      "id": "abc123",
      "name": "Private Room",
      "type": "private",
      "members": ["alice", "bob"],
      "createdAt": 1704153600000,
      "createdBy": "alice"
    }
  ]
}
```

### Create Room

Create a new chat room. Requires authentication.

```bash
POST /api/rooms
Authorization: Bearer {token}
X-Username: alice
Content-Type: application/json

{
  "type": "private",
  "members": ["alice", "bob"],
  "name": "Project Discussion"  // optional
}
```

**Request Body:**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `type` | string | Yes | `"public"` or `"private"` |
| `members` | string[] | For private | List of usernames |
| `name` | string | No | Room display name |

**Response (200):**

```json
{
  "room": {
    "id": "abc123def456",
    "name": "Project Discussion",
    "type": "private",
    "members": ["alice", "bob"],
    "createdAt": 1704067200000,
    "createdBy": "alice"
  }
}
```

### Get Room

Get details for a specific room.

```bash
GET /api/rooms/{id}
```

**Response (200):**

```json
{
  "room": {
    "id": "general",
    "name": "General Chat",
    "type": "public",
    "createdAt": 1704067200000,
    "createdBy": "ryo",
    "memberCount": 15
  }
}
```

### Delete Room

Delete a room. Only the room creator or admin can delete.

```bash
DELETE /api/rooms/{id}
Authorization: Bearer {token}
X-Username: alice
```

**Response (200):**

```json
{
  "success": true
}
```

### Join Room

Join a room to participate in chat.

```bash
POST /api/rooms/{id}/join
Content-Type: application/json

{
  "username": "alice"
}
```

**Response (200):**

```json
{
  "success": true
}
```

### Leave Room

Leave a room.

```bash
POST /api/rooms/{id}/leave
Content-Type: application/json

{
  "username": "alice"
}
```

**Response (200):**

```json
{
  "success": true
}
```

### List Active Users

Get list of users currently active in a room.

```bash
GET /api/rooms/{id}/users
```

**Response (200):**

```json
{
  "users": [
    {
      "username": "alice",
      "joinedAt": 1704067200000
    },
    {
      "username": "bob",
      "joinedAt": 1704153600000
    }
  ]
}
```

## Room Types

### Public Rooms

- Visible to all users in room listings
- Anyone can join without invitation
- Default room type for general discussions

### Private Rooms

- Only visible to members
- Created with a specific member list
- Ideal for direct messages or group chats

## Error Responses

| Status | Error | Description |
|--------|-------|-------------|
| 400 | `Invalid request` | Missing or invalid parameters |
| 401 | `Authentication required` | Token missing or invalid |
| 403 | `Forbidden` | Not authorized to perform action |
| 404 | `Room not found` | Room ID doesn't exist |
| 429 | `Rate limit exceeded` | Too many requests |

## Related

- [Auth API](/docs/auth-api) - Authentication endpoints
- [Messages API](/docs/messages-api) - Message endpoints
- [Presence API](/docs/presence-api) - Presence tracking
