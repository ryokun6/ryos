# Architecture & Build

Vite + Bun build system with multiple deployment targets.

## Deployment Targets

- **Web (PWA):** Deployed to Vercel
- **Desktop:** Tauri for macOS/Windows/Linux
- **Development:** Local with HMR

```mermaid
graph LR
    subgraph Source
        A[Source Code]
    end
    
    subgraph Build["Vite + Bun"]
        B[Bundle & Optimize]
    end
    
    subgraph Targets
        C[Web PWA]
        D[Desktop]
        E[Dev Server]
    end
    
    A --> B
    B --> C
    B --> D
    B --> E
    
    C --> F[Vercel CDN]
    D --> G[Tauri - macOS/Windows/Linux]
    E --> H[localhost + HMR]
```

## Chunk Splitting

**Core Chunks (Immediate):**
```
react: ["react", "react-dom"]
"ui-core": ["@radix-ui/react-dialog", ...]
zustand: ["zustand"]
motion: ["framer-motion"]
```

**Deferred Chunks:**

| Chunk | Contents | Trigger |
|-------|----------|---------|
| `audio` | tone, wavesurfer.js | Soundboard/iPod |
| `tiptap` | @tiptap/* | TextEdit |
| `three` | three.js | PC app |
| `ai-sdk` | ai, @ai-sdk/* | Chats/IE |

```mermaid
graph TD
    subgraph Core["Core Chunks (Immediate)"]
        R[react]
        UI[ui-core]
        Z[zustand]
        M[motion]
    end
    
    subgraph Deferred["Deferred Chunks (Lazy)"]
        AU[audio]
        TT[tiptap]
        TH[three]
        AI[ai-sdk]
    end
    
    subgraph Apps
        SB[Soundboard]
        IP[iPod]
        TE[TextEdit]
        PC[Virtual PC]
        CH[Chats]
        IE[Internet Explorer]
    end
    
    SB -.-> AU
    IP -.-> AU
    TE -.-> TT
    PC -.-> TH
    CH -.-> AI
    IE -.-> AI
```

## PWA Caching

| Pattern | Strategy | TTL |
|---------|----------|-----|
| Navigation | NetworkFirst | 1 day |
| JS Chunks | NetworkFirst (3s) | 1 day |
| CSS | StaleWhileRevalidate | 7 days |
| Images | CacheFirst | 30 days |
| Fonts | CacheFirst | 1 year |
